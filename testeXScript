-- Variável para controlar o estado do ataque automático
local autoKill = false
local player = game.Players.LocalPlayer

-- Função para seguir e atacar jogadores
local function followAndAttack()
    while autoKill do
        local character = player.Character
        local sword = character:FindFirstChildOfClass("Tool")

        -- Equipar a espada automaticamente se não estiver equipada
        if not sword or not sword.Name:lower():find("sword") then
            for _, tool in pairs(player.Backpack:GetChildren()) do
                if tool:IsA("Tool") and tool.Name:lower():find("sword") then
                    character.Humanoid:EquipTool(tool)
                    sword = tool
                    break
                end
            end
        end

        if sword and sword.Name:lower():find("sword") then
            for _, target in pairs(game.Players:GetPlayers()) do
                if target ~= player and not target.Character:FindFirstChild("ForceField") then
                    local targetCharacter = target.Character
                    if targetCharacter and targetCharacter:FindFirstChild("Humanoid") then
                        -- Função para seguir o alvo e atacar
                        local function followTarget()
                            while autoKill and targetCharacter.Humanoid.Health > 0 do
                                -- Teleportar para trás do jogador alvo e olhar para ele
                                local targetPosition = targetCharacter.PrimaryPart.Position
                                local behindPosition = targetPosition - (targetCharacter.PrimaryPart.CFrame.LookVector * 3)
                                character:SetPrimaryPartCFrame(CFrame.new(behindPosition, targetPosition))

                                -- Auto click para atacar sem delay
                                sword:Activate()
                                wait(0.01) -- Delay mínimo
                            end
                        end

                        -- Iniciar a função de seguir e atacar
                        followTarget()

                        -- Matar o jogador alvo
                        targetCharacter.Humanoid.Health = 0
                        wait(0.01) -- Esperar um pouco antes de ir para o próximo jogador
                    end
                end
            end
        else
            print("Você precisa estar com uma espada equipada")
        end
        wait(0.01) -- Pequeno delay antes de repetir o ciclo
    end
end

-- Alternador para ativar/desativar o ataque automático
local Toggle = Tabs.Main:AddToggle("autoKill", 
{
    Title = "Auto Kill all (Sword)", 
    Description = "Mate todos do Servidor (necessita de espada)",
    Default = false, 
    Callback = function(state)
        autoKill = state
        if autoKill then
            print("Auto Kill ativado")
            followAndAttack()
        else
            print("Auto Kill desativado")
        end
    end 
})

-- Conectar a função para seguir e atacar após o jogador renascer
player.CharacterAdded:Connect(function(character)
    character:WaitForChild("Humanoid") -- Esperar o Humanoid ser adicionado
    if autoKill then
        followAndAttack() -- Reiniciar a função de ataque automático
    end
end)

-- Botão para executar o Kill All manualmente
Tabs.Main:AddButton({ Title = "Kill All (Sword)", Callback = function() 
    local character = player.Character
    local sword = character:FindFirstChildOfClass("Tool")

    -- Equipar a espada automaticamente se não estiver equipada
    if not sword or not sword.Name:lower():find("sword") then
        for _, tool in pairs(player.Backpack:GetChildren()) do
            if tool:IsA("Tool") and tool.Name:lower():find("sword") then
                character.Humanoid:EquipTool(tool)
                sword = tool
                break
            end
        end
    end

    if sword and sword.Name:lower():find("sword") then
        for _, target in pairs(game.Players:GetPlayers()) do
            if target ~= player and not target.Character:FindFirstChild("ForceField") then
                local targetCharacter = target.Character
                if targetCharacter and targetCharacter:FindFirstChild("Humanoid") then
                    -- Função para seguir o alvo e atacar
                    local function followTarget()
                        while targetCharacter.Humanoid.Health > 0 do
                            -- Teleportar para trás do jogador alvo e olhar para ele
                            local targetPosition = targetCharacter.PrimaryPart.Position
                            local behindPosition = targetPosition - (targetCharacter.PrimaryPart.CFrame.LookVector * 3)
                            character:SetPrimaryPartCFrame(CFrame.new(behindPosition, targetPosition))

                            -- Auto click para atacar sem delay
                            sword:Activate()
                            wait(0.01) -- Delay mínimo
                        end
                    end

                    -- Iniciar a função de seguir e atacar
                    followTarget()

                    -- Matar o jogador alvo
                    targetCharacter.Humanoid.Health = 0
                    wait(0.01) -- Esperar um pouco antes de ir para o próximo jogador
                end
            end
        end
        print("Todos os jogadores foram mortos")
    else
        print("Você precisa estar com uma espada equipada")
    end
end })